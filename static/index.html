<!doctype html>
<html lang=en>
<head>
    <meta charset=utf-8>
<style>



.chart {
    background-color: lightgray;
	width:4000px;
	height:600px;
    line-height:600px;
}

.bar {
	display:inline-block;
	width:2px;
	background-color:cornflowerblue;
	border-right:1px solid white;
    vertical-align:bottom;
}


</style>

</head>
<body>
	<input type="text" id="zip" placeholder="zip code"/>
	<input type="button" id="submit" value="query"/>
    <div id="container"></div>
	
<script>

var container = document.getElementById("container");

document.getElementById("submit").onclick=function(e){
	var zip = document.getElementById("zip").value;
	request(zip);
};

function request (zip)
{
    var client = new XMLHttpRequest();
    client.onload = function(e){
        
        var datas = JSON.parse(client.response);
        container.innerHTML="";
        datas.forEach(renderChart);
    };

    client.open("GET", `/api/history/${zip}`);
    client.send();
}

function renderChart (data)
{
    var chart = document.createElement("div");
    chart.className="chart";

	var temps = data.map(x => x.temperature);
	var min = Math.min(...temps);
	var max = Math.max(...temps);
    console.log(min, max);
	var scale = max-min;

	data.forEach(d => {

		var el = document.createElement("div");
		el.className = "bar";
		//var height = ((d.temperature - min)/scale)*600;
        var height = ((d.temperature + 10)/100) * 100;

		var wtf = `${height}%`;

		el.style.height = wtf;
		chart.appendChild(el);
	});	
	
    container.appendChild(chart);

}
     
</script>
</body>
</html>
